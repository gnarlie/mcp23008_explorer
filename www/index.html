<!DOCTYPE html>
<html>
    <head>
	<title>MCP23008</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> 
        <script >
	    <!--
	    function oneStatusLine(data, label) {
		var s = parseInt(data);
		for(var i = 0; i < 8; i++) {
		    $('#' + label + i).text((s & (1 << i)) >> i);
		}
	    }
	    function status(xhr, msg) {
		    var info = JSON.parse(xhr.responseText);

		    oneStatusLine(info.gpio, 'status');
		    oneStatusLine(info.iodir, 'iodir');
		    oneStatusLine(info.gpinten, 'gpinten');
	    }
	    function dopoll() {
		$.ajax({url: "/status", type: "GET", datatype: "script", complete: status});    
	    }
	    function wire(clazz, url) {
		    $('.' + clazz ).click(function(e) {
			var pin = parseInt(e.currentTarget.innerText.split(' ')[1]);
			$.ajax({url: url + "/" + pin, type: "GET", datatype: "script", complete: status})
		});
	    }

	    $(function() {
		wire('pin', 'pins');
		wire('iodir', 'iodir');
		wire('gpinten', 'gpinten');
		
		setInterval(dopoll, 250);
            });
            -->
        </script>
    </head>
    <body>
	<div id=status></div>
	<table>
	    <tr>
		<td><button class='pin'>GPIO 0</button></td>
		<td><button class='pin'>GPIO 1</button></td>
		<td><button class='pin'>GPIO 2</button></td>
		<td><button class='pin'>GPIO 3</button></td>
		<td><button class='pin'>GPIO 4</button></td>
		<td><button class='pin'>GPIO 5</button></td>
		<td><button class='pin'>GPIO 6</button></td>
		<td><button class='pin'>GPIO 7</button></td>
	    </tr>
	    <tr>
		<td><span id='status0'></span></td>
		<td><span id='status1'></span></td>
		<td><span id='status2'></span></td>
		<td><span id='status3'></span></td>
		<td><span id='status4'></span></td>
		<td><span id='status5'></span></td>
		<td><span id='status6'></span></td>
		<td><span id='status7'></span></td>
	    </tr>
	    <tr>
		<td><button class='iodir'>IODIR 0</button></td>
		<td><button class='iodir'>IODIR 1</button></td>
		<td><button class='iodir'>IODIR 2</button></td>
		<td><button class='iodir'>IODIR 3</button></td>
		<td><button class='iodir'>IODIR 4</button></td>
		<td><button class='iodir'>IODIR 5</button></td>
		<td><button class='iodir'>IODIR 6</button></td>
		<td><button class='iodir'>IODIR 7</button></td>
	    </tr>		
	    <tr>
		<td><span id='iodir0'></span></td>
		<td><span id='iodir1'></span></td>
		<td><span id='iodir2'></span></td>
		<td><span id='iodir3'></span></td>
		<td><span id='iodir4'></span></td>
		<td><span id='iodir5'></span></td>
		<td><span id='iodir6'></span></td>
		<td><span id='iodir7'></span></td>
	    </tr>
	    <tr>
		<td><button class='gpinten'>GPINTEN 0</button></td>
		<td><button class='gpinten'>GPINTEN 1</button></td>
		<td><button class='gpinten'>GPINTEN 2</button></td>
		<td><button class='gpinten'>GPINTEN 3</button></td>
		<td><button class='gpinten'>GPINTEN 4</button></td>
		<td><button class='gpinten'>GPINTEN 5</button></td>
		<td><button class='gpinten'>GPINTEN 6</button></td>
		<td><button class='gpinten'>GPINTEN 7</button></td>
	    </tr>		
	    <tr>
		<td><span id='gpinten0'></span></td>
		<td><span id='gpinten1'></span></td>
		<td><span id='gpinten2'></span></td>
		<td><span id='gpinten3'></span></td>
		<td><span id='gpinten4'></span></td>
		<td><span id='gpinten5'></span></td>
		<td><span id='gpinten6'></span></td>
		<td><span id='gpinten7'></span></td>
	    </tr>
	</table>
    </body>
</html>
